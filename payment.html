<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paiement - YoTeacher</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üá´üá∑</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* R√âDUCTION DE LA HAUTEUR DU HEADER - M√äME QUE LOGIN.HTML */
        .main-header {
            background-color: rgba(255, 255, 255, 0.98) !important;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1) !important;
            backdrop-filter: blur(10px) !important;
            min-height: 60px !important;
        }
        
        .header-content {
            padding: 10px 0 !important;
        }
        
        .main-header .nav-link {
            display: none !important;
        }
        
        .main-header .nav-spacer {
            display: none !important;
        }
        
        .main-header .logo {
            color: #333 !important;
            font-weight: 700;
            font-size: 1.5rem !important;
        }
        
        .main-header .login-btn {
            background-color: #4f9ad1 !important;
            color: white !important;
            padding: 8px 20px !important;
            font-size: 0.9rem !important;
        }
        
        /* Style pour le s√©lecteur de devise dans le header r√©duit */
        .main-header .currency-selector {
            margin-left: 10px;
        }
        
        .main-header .currency-selector select {
            border: 1px solid #ddd;
            color: #333;
            padding: 5px 10px;
            font-size: 0.85rem;
            border-radius: 15px;
            background: white;
        }
        
        /* Style pour la notification Interac */
        .interac-currency-notice {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            color: #1565c0;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }
        
        .interac-currency-notice i {
            color: #1565c0;
            margin-right: 8px;
        }
        
        /* CORRECTION DU PADDING DU BODY */
        body {
            padding-top: 60px !important;
        }
        
        /* NOUVELLE STRUCTURE DE PAIEMENT */
        .payment-section {
            padding: 40px 20px;
            background: #f8f9fa;
            min-height: calc(100vh - 60px);
        }

        .payment-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .payment-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .payment-title {
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 15px;
        }

        .payment-subtitle {
            color: #666;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .payment-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
        }

        .payment-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 1px solid #eaeaea;
        }

        .card-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        /* NOUVEAUX BOUTONS DE PAIEMENT EN FORMAT LONG */
        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .payment-method-btn {
            width: 100%;
            padding: 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            text-align: left;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .payment-method-btn:hover {
            border-color: #3c84f6;
            background: #f0f7ff;
            transform: translateY(-2px);
        }

        .payment-method-btn.active {
            border-color: #3c84f6;
            background: #f0f7ff;
        }

        .payment-method-icon {
            font-size: 1.5rem;
            width: 40px;
            text-align: center;
        }

        .payment-method-name {
            flex: 1;
            margin-left: 15px;
        }

        .payment-method-arrow {
            font-size: 1.2rem;
            color: #666;
            transition: transform 0.3s;
        }

        .payment-method-btn.active .payment-method-arrow {
            transform: rotate(180deg);
            color: #3c84f6;
        }

        /* MENUS D√âROULANTS POUR LES M√âTHODES DE PAIEMENT */
        .payment-method-details {
            display: none;
            margin-top: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Styles pour Stripe Elements */
        .stripe-card-element {
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            margin-bottom: 15px;
            min-height: 50px;
        }

        #card-errors {
            color: #fa755a;
            margin-bottom: 15px;
            padding: 10px;
            background: #ffeaea;
            border-radius: 5px;
            display: none;
        }

        .payment-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            align-items: center;
        }

        .qr-code-container {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid #ddd;
        }

        .qr-code-placeholder {
            width: 180px;
            height: 180px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            border-radius: 8px;
            font-size: 2.5rem;
            color: #666;
        }

        .payment-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .info-item {
            padding: 12px 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .info-item.clickable:hover {
            background: #f0f7ff;
            border-color: #3c84f6;
            transform: translateY(-2px);
        }

        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-weight: 600;
            color: #333;
            word-break: break-all;
        }

        .payment-action {
            margin-top: 20px;
            grid-column: span 2;
        }

        .btn-confirm-payment {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-confirm-payment:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }

        .btn-confirm-payment:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Style pour le message important */
        .payment-notice {
            margin-top: 15px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 8px;
            border: 1px solid #ffeaa7;
            grid-column: span 2;
        }

        .payment-notice p {
            color: #856404;
            margin: 0;
            font-size: 0.95rem;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        /* R√âCAPITULATIF √Ä DROITE */
        .booking-summary-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #eaeaea;
            margin-bottom: 25px;
        }

        .summary-details {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-item.total {
            font-weight: 600;
            font-size: 1.2rem;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #ddd;
        }

        .summary-item .label {
            color: #666;
        }

        .summary-item .value {
            color: #333;
            font-weight: 500;
        }

        .payment-security {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin-top: 25px;
            border: 1px solid #c8e6c9;
        }

        .payment-security h4 {
            color: #2e7d32;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .error-message {
            background: #ffeaea;
            color: #d32f2f;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            border-left: 4px solid #d32f2f;
        }

        /* Style sp√©cifique pour Interac */
        .interac-details {
            width: 100%;
        }

        .interac-details .info-value {
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
        }

        .bank-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            margin: 20px 0;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-item .label {
            font-weight: 500;
            color: #666;
        }

        .detail-item .value {
            font-weight: 600;
            color: #333;
        }

        /* Style pour les QR codes */
        .qr-code-img {
            width: 180px;
            height: 180px;
            margin: 0 auto 15px;
            display: block;
            border-radius: 8px;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .qr-code-img:hover {
            transform: scale(1.05);
        }

        .qr-code-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
            display: block;
        }
        
        /* Info devise */
        .currency-info-payment {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            margin-top: 10px;
            padding: 8px;
            background: #f0f7ff;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .currency-info-payment i {
            color: #3c84f6;
            margin-right: 5px;
        }

        @media (max-width: 992px) {
            .payment-grid {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .payment-details-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .qr-code-container {
                order: 2;
            }
            
            .payment-info {
                order: 1;
            }
            
            .payment-action {
                grid-column: span 1;
            }
        }

        @media (max-width: 768px) {
            .payment-section {
                padding: 30px 15px;
                min-height: calc(100vh - 60px);
            }
            
            .payment-title {
                font-size: 2rem;
            }
            
            .payment-card {
                padding: 25px 20px;
            }
            
            .payment-method-btn {
                padding: 18px 15px;
                font-size: 1rem;
            }
            
            .stripe-card-element {
                padding: 15px;
            }
            
            /* Header mobile ajust√© */
            .main-header {
                min-height: 55px !important;
            }
            
            .header-content {
                padding: 8px 0 !important;
            }
            
            .logo {
                font-size: 1.3rem !important;
            }
            
            .mobile-login-btn-header {
                padding: 6px 12px !important;
                font-size: 0.85rem !important;
                order: 3;
                z-index: 1001;
            }
            
            /* Cacher le s√©lecteur de devise sur mobile */
            .main-header .currency-selector {
                display: none;
            }
            
            body {
                padding-top: 55px !important;
            }
            
            .payment-section {
                min-height: calc(100vh - 55px);
            }
        }

        @media (max-width: 480px) {
            .payment-card {
                padding: 20px 15px;
            }
            
            .payment-title {
                font-size: 1.8rem;
            }
            
            .card-title {
                font-size: 1.3rem;
            }
            
            .payment-method-btn {
                padding: 16px 12px;
            }
            
            .payment-details-grid {
                gap: 15px;
            }
            
            .qr-code-img, .qr-code-placeholder {
                width: 150px;
                height: 150px;
            }
            
            .qr-code-placeholder {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header r√©duit comme login.html -->
    <header class="main-header scrolled">
        <div class="container">
            <div class="header-content">
                <button class="hamburger-menu" id="hamburgerBtn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <div class="logo-section">
                    <a href="index.html" class="logo">Yoann</a>
                    <div class="flag">üá´üá∑</div>
                </div>
                
                <a href="login.html" class="mobile-login-btn-header">Connexion</a>
                
                <nav class="nav-menu desktop-menu">
                    <!-- Supprim√© les liens de navigation -->
                    
                    <!-- S√©lecteur de devise -->
                    <div class="currency-selector">
                        <i class="fas fa-money-bill-wave"></i>
                        <select id="currencySelector">
                            <!-- Rempli dynamiquement par currency.js -->
                        </select>
                    </div>
                    
                    <div class="language-switcher">
                        <span class="flag">üåê</span>
                        <span>FR</span>
                    </div>
                    
                    <a href="login.html" class="login-btn">Connexion</a>
                </nav>
            </div>
        </div>
    </header>

    <section class="payment-section">
        <div class="payment-container">
            <div class="payment-header">
                <h1 class="payment-title">Finaliser votre paiement</h1>
                <p class="payment-subtitle">Choisissez votre moyen de paiement et confirmez votre r√©servation</p>
                <div class="currency-info-payment" id="currencyInfoPayment">
                    <i class="fas fa-sync-alt"></i> Prix affich√©s en <span id="currentCurrency">EUR</span> - Conversion automatique
                </div>
            </div>
            
            <!-- Notification pour Interac -->
            <div class="interac-currency-notice" id="interacCurrencyNotice">
                <i class="fas fa-info-circle"></i>
                <strong>Note importante :</strong> Les paiements Interac doivent √™tre effectu√©s en dollars canadiens (CAD). 
                La devise a √©t√© automatiquement ajust√©e pour vous.
            </div>

            <div class="error-message" id="paymentError">
                <i class="fas fa-exclamation-circle"></i> <span id="errorText"></span>
            </div>

            <div class="payment-grid">
                <!-- Colonne gauche : Moyens de paiement -->
                <div class="payment-card">
                    <h2 class="card-title">Choisir un moyen de paiement</h2>
                    
                    <div class="payment-methods">
                        <!-- Revolut -->
                        <button class="payment-method-btn" data-method="revolut">
                            <div class="payment-method-icon" style="color: #FF5F00;">
                                <i class="fas fa-bank"></i>
                            </div>
                            <div class="payment-method-name">Revolut</div>
                            <div class="payment-method-arrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </button>
                        
                        <div class="payment-method-details" id="revolutDetails">
                            <div class="payment-details-grid">
                                <div class="qr-code-container">
                                    <span class="qr-code-label">Cliquez sur le QR code pour ouvrir Revolut</span>
                                    <img src="assets/images/revolut.jpeg" alt="QR Code Revolut" id="revolutQrCode" class="qr-code-img" title="Cliquez pour ouvrir Revolut">
                                </div>
                                
                                <div class="payment-info">
                                    <div class="info-item clickable" id="revolutLinkItem">
                                        <div class="info-label">Lien Revolut</div>
                                        <div class="info-value" id="revolutLinkDisplay">revolut.me/yoann</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Nom du b√©n√©ficiaire</div>
                                        <div class="info-value" id="revolutName">Yoann Bourbia</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">R√©f√©rence</div>
                                        <div class="info-value" id="revolutRef">COURS-<span id="revolutRefNum"></span></div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Montant</div>
                                        <div class="info-value" id="revolutAmount">-</div>
                                    </div>
                                </div>
                                
                                <div class="payment-notice">
                                    <p>
                                        <i class="fas fa-info-circle"></i>
                                        <strong>Important :</strong> Une fois le paiement effectu√© sur Revolut, cliquez sur "J'ai pay√© avec Revolut" pour confirmer votre r√©servation.
                                    </p>
                                </div>
                                
                                <div class="payment-action">
                                    <button class="btn-confirm-payment" data-method="revolut">
                                        <i class="fas fa-check"></i> J'ai pay√© avec Revolut
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Wise -->
                        <button class="payment-method-btn" data-method="wise">
                            <div class="payment-method-icon" style="color: #9C5BDE;">
                                <i class="fas fa-globe"></i>
                            </div>
                            <div class="payment-method-name">Wise</div>
                            <div class="payment-method-arrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </button>
                        
                        <div class="payment-method-details" id="wiseDetails">
                            <div class="payment-details-grid">
                                <div class="qr-code-container">
                                    <span class="qr-code-label">Cliquez sur le QR code pour ouvrir Wise</span>
                                    <img src="assets/images/wise.jpeg" alt="QR Code Wise" id="wiseQrCode" class="qr-code-img" title="Cliquez pour ouvrir Wise">
                                </div>
                                
                                <div class="payment-info">
                                    <div class="info-item clickable" id="wiseLinkItem">
                                        <div class="info-label">Lien Wise</div>
                                        <div class="info-value" id="wiseLinkDisplay">wise.com/pay/yoann</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Nom du b√©n√©ficiaire</div>
                                        <div class="info-value" id="wiseName">Yoann Bourbia</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Email Wise</div>
                                        <div class="info-value" id="wiseEmail">yoann@yoteacher.com</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Montant</div>
                                        <div class="info-value" id="wiseAmount">-</div>
                                    </div>
                                </div>
                                
                                <div class="payment-notice">
                                    <p>
                                        <i class="fas fa-info-circle"></i>
                                        <strong>Important :</strong> Une fois le paiement effectu√© sur Wise, cliquez sur "J'ai pay√© avec Wise" pour confirmer votre r√©servation.
                                    </p>
                                </div>
                                
                                <div class="payment-action">
                                    <button class="btn-confirm-payment" data-method="wise">
                                        <i class="fas fa-check"></i> J'ai pay√© avec Wise
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Interac -->
                        <button class="payment-method-btn" data-method="interac">
                            <div class="payment-method-icon" style="color: #E41E26;">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <div class="payment-method-name">Interac</div>
                            <div class="payment-method-arrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </button>
                        
                        <div class="payment-method-details" id="interacDetails">
                            <div class="interac-details">
                                <h3 style="margin-bottom: 20px; color: #333; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-university" style="color: #E41E26;"></i> Paiement Interac
                                </h3>
                                <p style="margin-bottom: 20px; color: #555;">
                                    Veuillez effectuer un virement Interac aux coordonn√©es suivantes :
                                </p>
                                
                                <div class="bank-details">
                                    <div class="detail-item">
                                        <span class="label">Nom du b√©n√©ficiaire:</span>
                                        <span class="value" id="interacName">Yoann Bourbia</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">Email Interac:</span>
                                        <span class="value" id="interacEmail">yoann@yoteacher.com</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">Montant:</span>
                                        <span class="value" id="interacAmount">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">R√©f√©rence:</span>
                                        <span class="value" id="interacRef">COURS-<span id="interacRefNum"></span></span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">Question de s√©curit√©:</span>
                                        <span class="value">YoTeacher</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">R√©ponse:</span>
                                        <span class="value">francais</span>
                                    </div>
                                </div>
                                
                                <div class="payment-notice">
                                    <p>
                                        <i class="fas fa-info-circle"></i>
                                        <strong>Important :</strong> Une fois le virement effectu√©, cliquez sur "J'ai pay√© avec Interac" pour confirmer votre r√©servation.
                                    </p>
                                </div>
                                
                                <div class="payment-action">
                                    <button class="btn-confirm-payment" data-method="interac">
                                        <i class="fas fa-check"></i> J'ai pay√© avec Interac
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- PayPal -->
                        <button class="payment-method-btn" data-method="paypal">
                            <div class="payment-method-icon" style="color: #003087;">
                                <i class="fab fa-paypal"></i>
                            </div>
                            <div class="payment-method-name">PayPal</div>
                            <div class="payment-method-arrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </button>
                        
                        <div class="payment-method-details" id="paypalDetails">
                            <div class="payment-details-grid">
                                <div class="qr-code-container">
                                    <span class="qr-code-label">Cliquez sur le QR code pour ouvrir PayPal</span>
                                    <img src="assets/images/paypal.jpeg" alt="QR Code PayPal" id="paypalQrCode" class="qr-code-img" title="Cliquez pour ouvrir PayPal">
                                </div>
                                
                                <div class="payment-info">
                                    <div class="info-item clickable" id="paypalLinkItem">
                                        <div class="info-label">Lien PayPal</div>
                                        <div class="info-value" id="paypalLinkDisplay">paypal.me/yoann</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Nom du b√©n√©ficiaire</div>
                                        <div class="info-value" id="paypalName">Yoann Bourbia</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Email PayPal</div>
                                        <div class="info-value" id="paypalEmail">yoann@yoteacher.com</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Montant</div>
                                        <div class="info-value" id="paypalAmount">-</div>
                                    </div>
                                </div>
                                
                                <div class="payment-notice">
                                    <p>
                                        <i class="fas fa-info-circle"></i>
                                        <strong>Important :</strong> Une fois le paiement effectu√© sur PayPal, cliquez sur "J'ai pay√© avec PayPal" pour confirmer votre r√©servation.
                                    </p>
                                </div>
                                
                                <div class="payment-action">
                                    <button class="btn-confirm-payment" data-method="paypal">
                                        <i class="fas fa-check"></i> J'ai pay√© avec PayPal
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Carte bancaire (Stripe) -->
                        <button class="payment-method-btn" data-method="card">
                            <div class="payment-method-icon" style="color: #635BFF;">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <div class="payment-method-name">Visa/Mastercard/Amex (Stripe)</div>
                            <div class="payment-method-arrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </button>
                        
                        <div class="payment-method-details" id="cardDetails">
                            <div class="card-form">
                                <div class="stripe-card-element" id="card-element"></div>
                                <div id="card-errors" role="alert"></div>
                                
                                <div class="payment-notice">
                                    <p>
                                        <i class="fas fa-lock"></i>
                                        <strong>S√©curis√© :</strong> Votre paiement est chiffr√© et s√©curis√© par Stripe. Aucune information bancaire n'est stock√©e sur nos serveurs.
                                    </p>
                                </div>
                                
                                <div class="payment-action">
                                    <button class="btn-confirm-payment" id="processCardPayment" data-method="card" disabled>
                                        <i class="fas fa-lock"></i> Payer par carte
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Colonne droite : R√©capitulatif -->
                <div class="payment-card">
                    <h2 class="card-title">R√©capitulatif</h2>
                    
                    <div id="paymentSummary">
                        <!-- Le r√©capitulatif sera inject√© par JavaScript -->
                    </div>
                    
                    <div class="payment-security">
                        <h4><i class="fas fa-shield-alt"></i> Paiement 100% s√©curis√©</h4>
                        <p style="font-size: 0.95rem; color: #2e7d32;">
                            <i class="fas fa-lock"></i> Vos donn√©es bancaires sont chiffr√©es<br>
                            <i class="fas fa-check-circle"></i> Aucune information stock√©e sur nos serveurs<br>
                            <i class="fas fa-clock"></i> R√©servation garantie apr√®s paiement
                        </p>
                    </div>
                    
                    <div style="margin-top: 25px; padding: 15px; background: #fff3cd; border-radius: 10px; border: 1px solid #ffeaa7;">
                        <p style="color: #856404; margin: 0; font-size: 0.95rem;">
                            <i class="fas fa-info-circle"></i> Votre cr√©neau est r√©serv√© pendant 15 minutes. 
                            Une fois le paiement confirm√©, vous recevrez un email avec le lien de la visioconf√©rence.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Script Stripe -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="supabase.js"></script>
    <script src="auth.js"></script>
    <script src="booking.js"></script>
    <script src="currency.js"></script>
    <script src="payment.js"></script>
    <script src="mobile-menu.js"></script>
    <script src="common.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Initialisation page paiement...');
        
        // R√©cup√©rer la r√©servation depuis l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const bookingParam = urlParams.get('booking');
        
        let currentBooking = null;
        
        if (bookingParam) {
            try {
                currentBooking = JSON.parse(decodeURIComponent(bookingParam));
                console.log('üìã R√©servation r√©cup√©r√©e:', currentBooking);
            } catch (error) {
                console.error('‚ùå Erreur parsing booking:', error);
                showPaymentError('R√©servation invalide. Veuillez r√©essayer.');
                return;
            }
        } else {
            // Essayer depuis localStorage
            const storedBooking = localStorage.getItem('pendingBooking');
            if (storedBooking) {
                try {
                    currentBooking = JSON.parse(storedBooking);
                } catch (error) {
                    console.error('‚ùå Erreur parsing stored booking:', error);
                }
            }
        }
        
        if (!currentBooking) {
            showPaymentError('Aucune r√©servation trouv√©e. Veuillez retourner √† la page de r√©servation.');
            setTimeout(() => {
                window.location.href = 'booking.html';
            }, 3000);
            return;
        }
        
        // Mettre √† jour les d√©tails de paiement ET le r√©capitulatif
        updatePaymentDetails(currentBooking);
        updatePaymentSummary(currentBooking);
        
        // Gestion des boutons de m√©thode de paiement
        document.querySelectorAll('.payment-method-btn').forEach(button => {
            button.addEventListener('click', function() {
                const method = this.getAttribute('data-method');
                togglePaymentMethod(method);
                
                // Si Interac est s√©lectionn√©, forcer la devise CAD
                if (method === 'interac' && window.currencyManager) {
                    const interacNotice = document.getElementById('interacCurrencyNotice');
                    
                    if (!window.currencyManager.isInteracCurrency()) {
                        // Afficher la notification
                        if (interacNotice) {
                            interacNotice.style.display = 'block';
                        }
                        
                        // Forcer la conversion en CAD
                        window.currencyManager.forceCADForInterac().then(() => {
                            // Mettre √† jour les prix apr√®s changement de devise
                            updatePaymentDetails(currentBooking);
                            updatePaymentSummary(currentBooking);
                        });
                    } else {
                        // Cacher la notification si d√©j√† en CAD
                        if (interacNotice) {
                            interacNotice.style.display = 'none';
                        }
                    }
                } else {
                    // Cacher la notification pour les autres m√©thodes
                    const interacNotice = document.getElementById('interacCurrencyNotice');
                    if (interacNotice) {
                        interacNotice.style.display = 'none';
                    }
                }
            });
        });
        
        // Gestion des clics sur les QR codes et liens cliquables
        setupClickableElements();
        
        // Gestion des boutons de confirmation de paiement
        document.querySelectorAll('.btn-confirm-payment').forEach(button => {
            button.addEventListener('click', async function() {
                if (this.disabled) return;
                
                const method = this.getAttribute('data-method');
                console.log('üí≥ Confirmation paiement:', method);
                
                // V√©rifier sp√©cialement pour Interac
                if (method === 'interac' && window.currencyManager && !window.currencyManager.isInteracCurrency()) {
                    showPaymentError('Les paiements Interac doivent √™tre effectu√©s en dollars canadiens (CAD). Veuillez s√©lectionner CAD comme devise.');
                    return;
                }
                
                // Afficher un indicateur de chargement
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Traitement en cours...';
                this.disabled = true;
                
                // Cacher les erreurs pr√©c√©dentes
                hidePaymentError();
                
                try {
                    // Initialiser le gestionnaire de paiement si n√©cessaire
                    if (window.paymentManager) {
                        // Passer la r√©servation actuelle au gestionnaire
                        window.paymentManager.currentBooking = currentBooking;
                        await window.paymentManager.handlePaymentMethod(method);
                    } else {
                        throw new Error('PaymentManager non disponible');
                    }
                } catch (error) {
                    console.error('‚ùå Erreur paiement:', error);
                    showPaymentError('Erreur lors du traitement : ' + error.message);
                    
                    // Restaurer le bouton
                    this.innerHTML = originalText;
                    this.disabled = false;
                }
            });
        });
        
        // √âcouter les changements de devise
        window.addEventListener('currency:ready', function() {
            updateCurrencyDisplay();
            if (currentBooking) {
                updatePaymentDetails(currentBooking);
                updatePaymentSummary(currentBooking);
            }
        });
        
        window.addEventListener('currency:changed', function() {
            updateCurrencyDisplay();
            if (currentBooking) {
                updatePaymentDetails(currentBooking);
                updatePaymentSummary(currentBooking);
            }
            
            // V√©rifier si Interac est s√©lectionn√©
            const interacBtn = document.querySelector('.payment-method-btn[data-method="interac"]');
            if (interacBtn && interacBtn.classList.contains('active')) {
                const interacNotice = document.getElementById('interacCurrencyNotice');
                if (!window.currencyManager.isInteracCurrency()) {
                    if (interacNotice) {
                        interacNotice.style.display = 'block';
                    }
                } else {
                    if (interacNotice) {
                        interacNotice.style.display = 'none';
                    }
                }
            }
        });
        
        // Fonctions
        function updatePaymentDetails(booking) {
            const refNumber = Date.now().toString().slice(-6);
            const amountEUR = booking.priceEUR || booking.price; // Prix en EUR
            
            // Configuration depuis config.js
            const config = window.YOTEACHER_CONFIG || {};
            
            // R√©cup√©rer les valeurs de configuration ou utiliser des valeurs par d√©faut
            const contactName = config.CONTACT_NAME || "Yoann Bourbia";
            const contactEmail = config.CONTACT_EMAIL || "yoann@yoteacher.com";
            const revolutLink = config.REVOLUT_PAYMENT_LINK || "https://revolut.me/yoann";
            const wiseLink = config.WISE_PAYMENT_LINK || "https://wise.com/pay/yoann";
            const paypalEmail = config.PAYPAL_BUSINESS_EMAIL || "yoann@yoteacher.com";
            const interacEmail = config.INTERAC_EMAIL || contactEmail;
            
            // Mettre √† jour les r√©f√©rences
            document.getElementById('revolutRefNum').textContent = refNumber;
            document.getElementById('interacRefNum').textContent = refNumber;
            
            // Calculer les montants dans la devise actuelle
            let currentAmount = booking.price;
            let currentCurrency = booking.currency || 'EUR';
            
            if (window.currencyManager) {
                currentCurrency = window.currencyManager.currentCurrency;
                currentAmount = window.currencyManager.convert(amountEUR, 'EUR', currentCurrency);
            }
            
            // Formater les montants
            const formattedAmount = window.currencyManager ? 
                window.currencyManager.formatPrice(amountEUR) : 
                `${currentAmount.toFixed(2)}${currentCurrency === 'EUR' ? '‚Ç¨' : ''}`;
            
            // Mettre √† jour les montants affich√©s
            document.querySelectorAll('#revolutAmount, #wiseAmount, #paypalAmount, #interacAmount').forEach(el => {
                el.textContent = formattedAmount;
            });
            
            // Mettre √† jour les noms
            document.querySelectorAll('#revolutName, #wiseName, #paypalName, #interacName').forEach(el => {
                el.textContent = contactName;
            });
            
            // Mettre √† jour les emails
            document.getElementById('wiseEmail').textContent = contactEmail;
            document.getElementById('paypalEmail').textContent = paypalEmail;
            document.getElementById('interacEmail').textContent = interacEmail;
            
            // Mettre √† jour les liens d'affichage
            const revolutDisplay = revolutLink.replace('https://', '');
            const wiseDisplay = wiseLink.replace('https://', '');
            const paypalUsername = paypalEmail.split('@')[0];
            const paypalDisplay = `paypal.me/${paypalUsername}`;
            
            document.getElementById('revolutLinkDisplay').textContent = revolutDisplay;
            document.getElementById('wiseLinkDisplay').textContent = wiseDisplay;
            document.getElementById('paypalLinkDisplay').textContent = paypalDisplay;
            
            // G√©n√©rer les QR codes dynamiques avec les montants convertis
            generateQrCodes(booking, revolutLink, wiseLink, paypalUsername, currentAmount, currentCurrency);
        }
        
        function updatePaymentSummary(booking) {
            const summaryContainer = document.getElementById('paymentSummary');
            if (!summaryContainer) return;
            
            const amountEUR = booking.priceEUR || booking.price;
            let amount = booking.price;
            let currency = booking.currency || 'EUR';
            
            // Utiliser le CurrencyManager pour convertir et formater
            if (window.currencyManager) {
                currency = window.currencyManager.currentCurrency;
                amount = window.currencyManager.convert(amountEUR, 'EUR', currency);
            }
            
            // Formater le prix
            const formattedPrice = window.currencyManager ? 
                window.currencyManager.formatPrice(amountEUR) : 
                `${amount.toFixed(2)} ${currency}`;
            
            // Formater la date
            const startDate = new Date(booking.startTime);
            const formattedDate = startDate.toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            const formattedTime = startDate.toLocaleTimeString('fr-FR', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // D√©terminer le nom du type de cours
            let courseName = '';
            switch(booking.courseType) {
                case 'essai':
                    courseName = 'Cours d\'essai';
                    break;
                case 'conversation':
                    courseName = 'Conversation';
                    break;
                case 'curriculum':
                    courseName = 'Curriculum complet';
                    break;
                default:
                    courseName = booking.courseType;
            }
            
            // D√©terminer la plateforme
            let platform = 'Zoom';
            if (booking.location && booking.location.includes('google')) {
                platform = 'Google Meet';
            } else if (booking.location && booking.location.includes('teams')) {
                platform = 'Microsoft Teams';
            }
            
            summaryContainer.innerHTML = `
                <div class="booking-summary-card">
                    <h3 style="margin-bottom: 20px; color: #333;">D√©tails de votre r√©servation</h3>
                    <div class="summary-details">
                        <div class="summary-item">
                            <span class="label">Type de cours:</span>
                            <span class="value">${courseName}</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Date:</span>
                            <span class="value">${formattedDate}</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Heure:</span>
                            <span class="value">${formattedTime}</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Dur√©e:</span>
                            <span class="value">${booking.duration || '15'} min</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">Plateforme:</span>
                            <span class="value">${platform}</span>
                        </div>
                        <div class="summary-item total">
                            <span class="label">Total √† payer:</span>
                            <span class="value">${formattedPrice}</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function generateQrCodes(booking, revolutLink, wiseLink, paypalUsername, amount, currency) {
            // QR Code Revolut
            const revolutFullLink = `${revolutLink}?amount=${amount}&currency=${currency}&reference=COURS-${Date.now().toString().slice(-6)}`;
            const revolutQrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(revolutFullLink)}`;
            const revolutQrImg = document.getElementById('revolutQrCode');
            revolutQrImg.src = revolutQrUrl;
            revolutQrImg.dataset.link = revolutFullLink;
            
            // QR Code Wise
            const wiseFullLink = `${wiseLink}?amount=${amount}&currency=${currency}`;
            const wiseQrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(wiseFullLink)}`;
            const wiseQrImg = document.getElementById('wiseQrCode');
            wiseQrImg.src = wiseQrUrl;
            wiseQrImg.dataset.link = wiseFullLink;
            
            // QR Code PayPal
            const paypalFullLink = `https://www.paypal.com/paypalme/${paypalUsername}/${amount}${currency}`;
            const paypalQrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(paypalFullLink)}`;
            const paypalQrImg = document.getElementById('paypalQrCode');
            paypalQrImg.src = paypalQrUrl;
            paypalQrImg.dataset.link = paypalFullLink;
            
            // Stocker les liens pour les clics
            document.getElementById('revolutLinkItem').dataset.link = revolutFullLink;
            document.getElementById('wiseLinkItem').dataset.link = wiseFullLink;
            document.getElementById('paypalLinkItem').dataset.link = paypalFullLink;
        }
        
        function setupClickableElements() {
            // QR codes cliquables
            document.querySelectorAll('.qr-code-img').forEach(img => {
                img.addEventListener('click', function() {
                    const link = this.dataset.link;
                    if (link) {
                        window.open(link, '_blank');
                    }
                });
            });
            
            // Liens textuels cliquables
            document.querySelectorAll('.info-item.clickable').forEach(item => {
                item.addEventListener('click', function() {
                    const link = this.dataset.link;
                    if (link) {
                        window.open(link, '_blank');
                    }
                });
            });
        }
        
        function togglePaymentMethod(method) {
            // Fermer tous les autres menus
            document.querySelectorAll('.payment-method-details').forEach(details => {
                details.style.display = 'none';
            });
            
            // Retirer la classe active de tous les boutons
            document.querySelectorAll('.payment-method-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ouvrir le menu correspondant
            const detailsId = method + 'Details';
            const detailsElement = document.getElementById(detailsId);
            const buttonElement = document.querySelector(`[data-method="${method}"]`);
            
            if (detailsElement && buttonElement) {
                // V√©rifier si le menu est d√©j√† ouvert
                const isAlreadyOpen = detailsElement.style.display === 'block';
                
                if (!isAlreadyOpen) {
                    detailsElement.style.display = 'block';
                    buttonElement.classList.add('active');
                    
                    // Si c'est la carte, initialiser Stripe
                    if (method === 'card' && window.paymentManager && typeof window.paymentManager.setupStripeForm === 'function') {
                        window.paymentManager.setupStripeForm();
                    }
                    
                    // Scroller vers le menu si sur mobile
                    if (window.innerWidth <= 768) {
                        setTimeout(() => {
                            detailsElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }, 100);
                    }
                } else {
                    detailsElement.style.display = 'none';
                    buttonElement.classList.remove('active');
                }
            }
        }
        
        function showPaymentError(message) {
            const errorDiv = document.getElementById('paymentError');
            const errorText = document.getElementById('errorText');
            
            if (errorDiv && errorText) {
                errorText.textContent = message;
                errorDiv.style.display = 'block';
                
                // Scroller vers l'erreur
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                alert('Erreur: ' + message);
            }
        }
        
        function hidePaymentError() {
            const errorDiv = document.getElementById('paymentError');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
        }
        
        function updateCurrencyDisplay() {
            if (window.currencyManager) {
                const currentCurrencySpan = document.getElementById('currentCurrency');
                if (currentCurrencySpan) {
                    currentCurrencySpan.textContent = window.currencyManager.currentCurrency;
                }
            }
        }
        
        // Fermer les menus en cliquant en dehors
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.payment-method-btn') && !event.target.closest('.payment-method-details')) {
                document.querySelectorAll('.payment-method-details').forEach(details => {
                    details.style.display = 'none';
                });
                
                document.querySelectorAll('.payment-method-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
            }
        });
        
        // Mettre √† jour l'affichage de la devise au chargement
        updateCurrencyDisplay();
        
        console.log('‚úÖ Page paiement initialis√©e');
    });
    </script>
</body>
</html>