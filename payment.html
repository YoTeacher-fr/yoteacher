<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="payment.title">Paiement - YoTeach</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üá´üá∑</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* R√âDUCTION DE LA HAUTEUR DU HEADER - COMME BOOKING.HTML */
        .main-header {
            background-color: rgba(255, 255, 255, 0.98) !important;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1) !important;
            backdrop-filter: blur(10px) !important;
            min-height: 60px !important;
        }

        /* CORRECTION COMPL√àTE DU HEADER POUR ALIGNEMENT √Ä DROITE */
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0 !important;
            width: 100%;
        }

        .logo-section {
            flex: 0 0 auto;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .main-header .nav-link {
            display: none !important;
        }

        .main-header .nav-spacer {
            display: none !important;
        }

        .main-header .logo {
            color: #333 !important;
            font-weight: 700;
            font-size: 1.5rem !important;
        }

        /* Grouper langue, devise et avatar √† droite */
        .header-right-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: auto;
            flex: 0 0 auto;
        }

        /* Devise dans le header r√©duit */
        .currency-selector {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .currency-selector select {
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-radius: 20px;
            padding: 4px 8px;
            color: #333;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            outline: none;
            width: auto;
            min-width: 70px;
            text-align: center;
            text-align-last: center;
            appearance: none;
            -webkit-appearance: none;
            transition: all 0.3s ease;
        }

        .currency-selector i {
            font-size: 0.9rem;
            color: #333;
        }

        /* Langue dans le header r√©duit */
        .language-switcher {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
            color: #333;
            padding: 4px 8px;
        }

        /* Bouton Connexion dans le header r√©duit */
        .main-header .login-btn {
            padding: 8px 20px !important;
            font-size: 0.9rem !important;
            font-weight: 600 !important;
            border-radius: 50px;
            background: #4f9ad1 !important;
            color: white !important;
            border: none;
            transition: all 0.3s ease;
            text-decoration: none;
            white-space: nowrap;
        }

        .main-header .login-btn:hover {
            background: #3c84f6 !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(60, 132, 246, 0.3);
        }

        /* Avatar utilisateur */
        .user-avatar {
            position: relative;
            cursor: pointer;
        }

        .avatar-img {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4f9ad1, #3c84f6);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-menu {
            position: absolute;
            top: 45px;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            min-width: 180px;
            padding: 10px 0;
            display: none;
            z-index: 1000;
            border: 1px solid #eee;
        }

        .user-avatar:hover .user-menu {
            display: block;
        }

        .user-menu a {
            display: block;
            padding: 10px 15px;
            color: #333;
            text-decoration: none;
            font-size: 0.9rem;
            transition: background 0.3s;
            white-space: nowrap;
        }

        .user-menu a:hover {
            background: #f5f5f5;
            color: #3c84f6;
        }

        .user-menu .logout-btn {
            border-top: 1px solid #eee;
            color: #d32f2f;
            margin-top: 5px;
        }

        .user-menu .logout-btn:hover {
            background: #ffeaea;
        }

        /* Menu hamburger */
        .hamburger-menu {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            margin-right: 10px;
        }

        .hamburger-menu span {
            display: block;
            width: 25px;
            height: 3px;
            background: #333;
            margin: 4px 0;
            border-radius: 2px;
            transition: 0.3s;
        }

        /* Menu mobile */
        .mobile-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 10000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .mobile-menu-overlay.active {
            display: block;
            opacity: 1;
        }

        .mobile-nav {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background: white;
            padding: 20px;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.3s;
        }

        .mobile-menu-overlay.active .mobile-nav {
            transform: translateX(0);
        }

        .close-menu {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            color: #333;
            cursor: pointer;
        }

        .mobile-nav-link {
            display: block;
            padding: 15px 0;
            color: #333;
            text-decoration: none;
            font-size: 1.1rem;
            border-bottom: 1px solid #eee;
        }

        /* CORRECTION DU PADDING DU BODY */
        body {
            padding-top: 60px !important;
        }

        /* Bouton connexion mobile */
        .mobile-login-btn-header {
            display: none !important;
        }

        /* Styles pour le menu mobile */
        .currency-selector-mobile {
            padding: 15px 0;
            border-top: 1px solid #eee;
            margin-top: 15px;
        }

        .currency-selector-mobile label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .currency-selector-mobile select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 0.9rem;
        }

        .mobile-language {
            padding: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            margin-top: 15px;
        }

        .mobile-login-btn {
            margin: 20px 0 10px;
            padding: 12px;
            text-align: center;
            background: #3c84f6;
            color: white;
            border-radius: 8px;
            text-decoration: none;
            display: block;
            font-weight: 600;
            transition: background 0.3s;
        }

        .mobile-login-btn:hover {
            background: #2c74e6;
        }

        /* Style pour la notification Interac */
        .interac-currency-notice {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            color: #1565c0;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }
        
        .interac-currency-notice i {
            color: #1565c0;
            margin-right: 8px;
        }
        
        /* NOUVELLE STRUCTURE DE PAIEMENT */
        .payment-section {
            padding: 40px 20px;
            background: #f8f9fa;
            min-height: calc(100vh - 60px);
        }

        .payment-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .payment-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .payment-title {
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 15px;
        }

        .payment-subtitle {
            color: #666;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .payment-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
        }

        .payment-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 1px solid #eaeaea;
        }

        .card-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        /* NOUVEAUX BOUTONS DE PAIEMENT EN FORMAT LONG */
        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .payment-method-btn {
            width: 100%;
            padding: 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            text-align: left;
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .payment-method-btn:hover {
            border-color: #3c84f6;
            background: #f0f7ff;
            transform: translateY(-2px);
        }

        .payment-method-btn.active {
            border-color: #3c84f6;
            background: #f0f7ff;
        }

        .payment-method-icon {
            font-size: 1.5rem;
            width: 40px;
            text-align: center;
        }

        .payment-method-name {
            flex: 1;
            margin-left: 15px;
        }

        .payment-method-arrow {
            font-size: 1.2rem;
            color: #666;
            transition: transform 0.3s;
        }

        .payment-method-btn.active .payment-method-arrow {
            transform: rotate(180deg);
            color: #3c84f6;
        }

        /* MENUS D√âROULANTS POUR LES M√âTHODES DE PAIEMENT */
        .payment-method-details {
            display: none;
            margin-top: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Styles pour Stripe Elements */
        .stripe-card-element {
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            margin-bottom: 15px;
            min-height: 50px;
        }

        #card-errors {
            color: #fa755a;
            margin-bottom: 15px;
            padding: 10px;
            background: #ffeaea;
            border-radius: 5px;
            display: none;
        }

        .payment-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            align-items: center;
        }

        .qr-code-container {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid #ddd;
        }

        .qr-code-placeholder {
            width: 180px;
            height: 180px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            border-radius: 8px;
            border: 2px dashed #bbb;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
        }

        .qr-code-placeholder:hover {
            background: linear-gradient(135deg, #e3e8f0 0%, #a8b5d1 100%);
            border-color: #3c84f6;
            color: #3c84f6;
            transform: scale(1.02);
        }

        .qr-code-placeholder i {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .payment-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .info-item {
            padding: 12px 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .info-item.clickable:hover {
            background: #f0f7ff;
            border-color: #3c84f6;
            transform: translateY(-2px);
        }

        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-weight: 600;
            color: #333;
            word-break: break-all;
        }

        .payment-action {
            margin-top: 20px;
            grid-column: span 2;
        }

        .btn-confirm-payment {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-confirm-payment:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }

        .btn-confirm-payment:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Style pour le message important */
        .payment-notice {
            margin-top: 15px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 8px;
            border: 1px solid #ffeaa7;
            grid-column: span 2;
        }

        .payment-notice p {
            color: #856404;
            margin: 0;
            font-size: 0.95rem;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        /* R√âCAPITULATIF √Ä DROITE */
        .booking-summary-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #eaeaea;
            margin-bottom: 25px;
        }

        .summary-details {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-item.total {
            font-weight: 600;
            font-size: 1.2rem;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #ddd;
        }

        .summary-item .label {
            color: #666;
        }

        .summary-item .value {
            color: #333;
            font-weight: 500;
        }

        .payment-security {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin-top: 25px;
            border: 1px solid #c8e6c9;
        }

        .payment-security h4 {
            color: #2e7d32;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .error-message {
            background: #ffeaea;
            color: #d32f2f;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            border-left: 4px solid #d32f2f;
        }

        /* Style sp√©cifique pour Interac */
        .interac-details {
            width: 100%;
        }

        .interac-details .info-value {
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
        }

        .bank-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            margin: 20px 0;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-item .label {
            font-weight: 500;
            color: #666;
        }

        .detail-item .value {
            font-weight: 600;
            color: #333;
        }

        /* Style pour les QR codes */
        .qr-code-img {
            width: 180px;
            height: 180px;
            margin: 0 auto 15px;
            display: block;
            border-radius: 8px;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .qr-code-img:hover {
            transform: scale(1.05);
        }

        .qr-code-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
            display: block;
        }
        
        /* Info devise */
        .currency-info-payment {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            margin-top: 10px;
            padding: 8px;
            background: #f0f7ff;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .currency-info-payment i {
            color: #3c84f6;
            margin-right: 5px;
        }

        /* Header mobile ajust√© */
        @media (max-width: 768px) {
            .hamburger-menu {
                display: block;
            }
            
            .mobile-login-btn-header {
                display: block !important;
                padding: 6px 12px;
                font-size: 0.85rem;
                background: #4f9ad1;
                color: white;
                border-radius: 20px;
                text-decoration: none;
            }
            
            /* Cacher les √©l√©ments du groupe droit sur mobile */
            .header-right-group {
                display: none;
            }
            
            .main-header .login-btn {
                display: none !important;
            }
            
            .language-switcher {
                display: none;
            }
            
            .currency-selector {
                display: none;
            }
            
            .user-avatar {
                display: none;
            }
            
            .logo-section {
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
            }
            
            .header-content {
                justify-content: space-between;
            }
        }

        @media (max-width: 992px) {
            .payment-grid {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .payment-details-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .qr-code-container {
                order: 2;
            }
            
            .payment-info {
                order: 1;
            }
            
            .payment-action {
                grid-column: span 1;
            }
        }

        @media (max-width: 768px) {
            .payment-section {
                padding: 30px 15px;
                min-height: calc(100vh - 60px);
            }
            
            .payment-title {
                font-size: 2rem;
            }
            
            .payment-card {
                padding: 25px 20px;
            }
            
            .payment-method-btn {
                padding: 18px 15px;
                font-size: 1rem;
            }
            
            .stripe-card-element {
                padding: 15px;
            }
            
            .main-header {
                min-height: 55px !important;
            }
            
            .header-content {
                padding: 8px 0 !important;
            }
            
            .logo {
                font-size: 1.3rem !important;
            }
            
            .mobile-login-btn-header {
                padding: 6px 12px !important;
                font-size: 0.85rem !important;
                order: 3;
                z-index: 1001;
            }
            
            body {
                padding-top: 55px !important;
            }
            
            .payment-section {
                min-height: calc(100vh - 55px);
            }
        }

        @media (max-width: 480px) {
            .payment-card {
                padding: 20px 15px;
            }
            
            .payment-title {
                font-size: 1.8rem;
            }
            
            .card-title {
                font-size: 1.3rem;
            }
            
            .payment-method-btn {
                padding: 16px 12px;
            }
            
            .payment-details-grid {
                gap: 15px;
            }
            
            .qr-code-img, .qr-code-placeholder {
                width: 150px;
                height: 150px;
            }
            
            .qr-code-placeholder i {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header r√©duit comme booking.html -->
    <header class="main-header scrolled">
        <div class="container">
            <div class="header-content">
                <button class="hamburger-menu" id="hamburgerBtn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <div class="logo-section">
                    <a href="index.html" class="logo">Yoann</a>
                    <div class="flag">üá´üá∑</div>
                </div>
                
                <a href="login.html" class="mobile-login-btn-header" data-i18n="header.login">Connexion</a>
                
                <!-- Groupe droit pour langue, devise et avatar -->
                <div class="header-right-group">
                    <!-- Avatar utilisateur -->
                    <div class="user-avatar" id="userAvatar" style="display: none;">
                        <div class="avatar-img" id="avatarInitials">Y</div>
                        <div class="user-menu">
                            <a href="dashboard.html" data-i18n="payment.my_dashboard">Mon tableau de bord</a>
                            <a href="profile.html" data-i18n="payment.my_profile">Mon profil</a>
                            <a href="bookings.html" data-i18n="payment.my_bookings">Mes r√©servations</a>
                            <a href="#" class="logout-btn" id="logoutBtn" data-i18n="dashboard.logout">D√©connexion</a>
                        </div>
                    </div>
                    
                    <!-- S√©lecteur de devise -->
                    <div class="currency-selector">
                        <i class="fas fa-money-bill-wave"></i>
                        <select id="currencySelector"></select>
                    </div>
                    
                    <!-- S√©lecteur de langue -->
                    <div class="language-switcher" id="languageSwitcherDesktop">
                        <span class="flag">üåê</span>
                        <span data-i18n="header.language">EN</span>
                    </div>
                    
                    <!-- Bouton de connexion (visible si non connect√©) -->
                    <a href="login.html" class="login-btn" id="loginBtn" data-i18n="header.login">Connexion</a>
                </div>
            </div>
        </div>
        
        <!-- Menu Mobile -->
        <div class="mobile-menu-overlay" id="mobileMenu">
            <nav class="mobile-nav">
                <button class="close-menu" id="closeMenuBtn">√ó</button>
                <a href="index.html#about" class="mobile-nav-link" data-i18n="nav.about">√Ä propos</a>
                <a href="index.html#courses" class="mobile-nav-link" data-i18n="nav.courses">Cours</a>
                <a href="index.html#testimonials" class="mobile-nav-link" data-i18n="nav.testimonials">T√©moignages</a>
                <a href="index.html#contact" class="mobile-nav-link" data-i18n="nav.contact">Contact</a>
                
                <!-- S√©lecteur de devise mobile -->
                <div class="currency-selector-mobile">
                    <label><i class="fas fa-money-bill-wave"></i> <span data-i18n="payment.currency">Devise</span></label>
                    <select id="currencySelectorMobile"></select>
                </div>
                
                <div class="mobile-language" id="languageSwitcherMobile">
                    <span class="flag">üåê</span>
                    <span data-i18n="header.language">EN</span>
                </div>
                
                <a href="login.html" class="mobile-login-btn" data-i18n="header.login">Connexion</a>
            </nav>
        </div>
    </header>

    <section class="payment-section">
        <div class="payment-container">
            <div class="payment-header">
                <h1 class="payment-title" data-i18n="payment.title_main">Finaliser votre paiement</h1>
                <p class="payment-subtitle" data-i18n="payment.subtitle">Choisissez votre moyen de paiement et confirmez votre r√©servation</p>
                <div class="currency-info-payment" id="currencyInfoPayment">
                    <i class="fas fa-sync-alt"></i> <span data-i18n="payment.currency_info">Prix affich√©s en</span> <span id="currentCurrency">EUR</span> - <span data-i18n="payment.auto_conversion">Conversion automatique</span>
                </div>
            </div>
            
            <!-- Notification pour Interac -->
            <div class="interac-currency-notice" id="interacCurrencyNotice">
                <i class="fas fa-info-circle"></i>
                <strong data-i18n="payment.interac_note">Note importante :</strong> <span data-i18n="payment.interac_message">Les paiements Interac doivent √™tre effectu√©s en dollars canadiens (CAD). La devise a √©t√© automatiquement ajust√©e pour vous.</span>
            </div>

            <div class="error-message" id="paymentError">
                <i class="fas fa-exclamation-circle"></i> <span id="errorText"></span>
            </div>

            <div class="payment-grid">
                <!-- Colonne gauche : Moyens de paiement -->
                <div class="payment-card">
                    <h2 class="card-title" data-i18n="payment.choose_method">Choisir un moyen de paiement</h2>
                    
                    <div class="payment-methods">
                        <!-- Revolut -->
                        <button class="payment-method-btn" data-method="revolut">
                            <div class="payment-method-icon" style="color: #FF5F00;">
                                <i class="fas fa-bank"></i>
                            </div>
                            <div class="payment-method-name">Revolut</div>
                            <div class="payment-method-arrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </button>
                        
                        <div class="payment-method-details" id="revolutDetails">
                            <div class="payment-details-grid">
                                <div class="qr-code-container">
                                    <span class="qr-code-label" data-i18n="payment.revolut_qr">Cliquez sur le QR code pour ouvrir Revolut</span>
                                    <img src="assets/images/revolut.jpeg" alt="QR Code Revolut" id="revolutQrCode" class="qr-code-img" title="Cliquez pour ouvrir Revolut">
                                </div>
                                
                                <div class="payment-info">
                                    <div class="info-item clickable" id="revolutLinkItem">
                                        <div class="info-label" data-i18n="payment.revolut_link">Lien Revolut</div>
                                        <div class="info-value" id="revolutLinkDisplay">revolut.me/yoann</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label" data-i18n="payment.beneficiary_name">Nom du b√©n√©ficiaire</div>
                                        <div class="info-value" id="revolutName">Yoann Bourbia</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label" data-i18n="payment.reference">R√©f√©rence</div>
                                        <div class="info-value" id="revolutRef">COURS-<span id="revolutRefNum"></span></div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label" data-i18n="payment.amount">Montant</div>
                                        <div class="info-value" id="revolutAmount">-</div>
                                    </div>
                                </div>
                                
                                <div class="payment-notice">
                                    <p>
                                        <i class="fas fa-info-circle"></i>
                                        <strong data-i18n="payment.important">Important :</strong> <span data-i18n="payment.revolut_notice">Une fois le paiement effectu√© sur Revolut, cliquez sur "J'ai pay√© avec Revolut" pour confirmer votre r√©servation.</span>
                                    </p>
                                </div>
                                
                                <div class="payment-action">
                                    <button class="btn-confirm-payment" data-method="revolut">
                                        <i class="fas fa-check"></i> <span data-i18n="payment.paid_revolut">J'ai pay√© avec Revolut</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Wise -->
                        <button class="payment-method-btn" data-method="wise">
                            <div class="payment-method-icon" style="color: #9C5BDE;">
                                <i class="fas fa-globe"></i>
                            </div>
                            <div class="payment-method-name">Wise</div>
                            <div class="payment-method-arrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </button>
                        
                        <div class="payment-method-details" id="wiseDetails">
                            <div class="payment-details-grid">
                                <div class="qr-code-container">
                                    <span class="qr-code-label" data-i18n="payment.wise_qr">Cliquez sur le QR code pour ouvrir Wise</span>
                                    <img src="assets/images/wise.jpeg" alt="QR Code Wise" id="wiseQrCode" class="qr-code-img" title="Cliquez pour ouvrir Wise">
                                </div>
                                
                                <div class="payment-info">
                                    <div class="info-item clickable" id="wiseLinkItem">
                                        <div class="info-label" data-i18n="payment.wise_link">Lien Wise</div>
                                        <div class="info-value" id="wiseLinkDisplay">wise.com/pay/yoann</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label" data-i18n="payment.beneficiary_name">Nom du b√©n√©ficiaire</div>
                                        <div class="info-value" id="wiseName">Yoann Bourbia</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label" data-i18n="payment.wise_email">Email Wise</div>
                                        <div class="info-value" id="wiseEmail">yoann@yoteacher.com</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label" data-i18n="payment.amount">Montant</div>
                                        <div class="info-value" id="wiseAmount">-</div>
                                    </div>
                                </div>
                                
                                <div class="payment-notice">
                                    <p>
                                        <i class="fas fa-info-circle"></i>
                                        <strong data-i18n="payment.important">Important :</strong> <span data-i18n="payment.wise_notice">Une fois le paiement effectu√© sur Wise, cliquez sur "J'ai pay√© avec Wise" pour confirmer votre r√©servation.</span>
                                    </p>
                                </div>
                                
                                <div class="payment-action">
                                    <button class="btn-confirm-payment" data-method="wise">
                                        <i class="fas fa-check"></i> <span data-i18n="payment.paid_wise">J'ai pay√© avec Wise</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Interac -->
                        <button class="payment-method-btn" data-method="interac">
                            <div class="payment-method-icon" style="color: #E41E26;">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <div class="payment-method-name">Interac</div>
                            <div class="payment-method-arrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </button>
                        
                        <div class="payment-method-details" id="interacDetails">
                            <div class="interac-details">
                                <h3 style="margin-bottom: 20px; color: #333; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-university" style="color: #E41E26;"></i> <span data-i18n="payment.interac_title">Paiement Interac</span>
                                </h3>
                                <p style="margin-bottom: 20px; color: #555;" data-i18n="payment.interac_instructions">
                                    Veuillez effectuer un virement Interac aux coordonn√©es suivantes :
                                </p>
                                
                                <div class="bank-details">
                                    <div class="detail-item">
                                        <span class="label" data-i18n="payment.beneficiary_name">Nom du b√©n√©ficiaire:</span>
                                        <span class="value" id="interacName">Yoann Bourbia</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label" data-i18n="payment.interac_email">Email Interac:</span>
                                        <span class="value" id="interacEmail">yoannbourbia@gmail.com</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label" data-i18n="payment.amount">Montant:</span>
                                        <span class="value" id="interacAmount">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label" data-i18n="payment.reference">R√©f√©rence:</span>
                                        <span class="value" id="interacRef">COURS-<span id="interacRefNum"></span></span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label" data-i18n="payment.security_question">Question de s√©curit√©:</span>
                                        <span class="value">YoTeach</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label" data-i18n="payment.answer">R√©ponse:</span>
                                        <span class="value">francais</span>
                                    </div>
                                </div>
                                
                                <div class="payment-notice">
                                    <p>
                                        <i class="fas fa-info-circle"></i>
                                        <strong data-i18n="payment.important">Important :</strong> <span data-i18n="payment.interac_notice">Une fois le virement effectu√©, cliquez sur "J'ai pay√© avec Interac" pour confirmer votre r√©servation.</span>
                                    </p>
                                </div>
                                
                                <div class="payment-action">
                                    <button class="btn-confirm-payment" data-method="interac">
                                        <i class="fas fa-check"></i> <span data-i18n="payment.paid_interac">J'ai pay√© avec Interac</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- PayPal -->
                        <button class="payment-method-btn" data-method="paypal">
                            <div class="payment-method-icon" style="color: #003087;">
                                <i class="fab fa-paypal"></i>
                            </div>
                            <div class="payment-method-name">PayPal</div>
                            <div class="payment-method-arrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </button>
                        
                        <div class="payment-method-details" id="paypalDetails">
                            <div class="payment-details-grid">
                                <div class="qr-code-container">
                                    <span class="qr-code-label" data-i18n="payment.paypal_qr">Cliquez sur le QR code pour ouvrir PayPal</span>
                                    <img src="assets/images/paypal.jpeg" alt="QR Code PayPal" id="paypalQrCode" class="qr-code-img" title="Cliquez pour ouvrir PayPal">
                                </div>
                                
                                <div class="payment-info">
                                    <div class="info-item clickable" id="paypalLinkItem">
                                        <div class="info-label" data-i18n="payment.paypal_link">Lien PayPal</div>
                                        <div class="info-value" id="paypalLinkDisplay">paypal.me/yoann</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label" data-i18n="payment.beneficiary_name">Nom du b√©n√©ficiaire</div>
                                        <div class="info-value" id="paypalName">Yoann Bourbia</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label" data-i18n="payment.paypal_email">Email PayPal</div>
                                        <div class="info-value" id="paypalEmail">yoann.bourbia@gmail.com</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label" data-i18n="payment.amount">Montant</div>
                                        <div class="info-value" id="paypalAmount">-</div>
                                    </div>
                                </div>
                                
                                <div class="payment-notice">
                                    <p>
                                        <i class="fas fa-info-circle"></i>
                                        <strong data-i18n="payment.important">Important :</strong> <span data-i18n="payment.paypal_notice">Une fois le paiement effectu√© sur PayPal, cliquez sur "J'ai pay√© avec PayPal" pour confirmer votre r√©servation.</span>
                                    </p>
                                </div>
                                
                                <div class="payment-action">
                                    <button class="btn-confirm-payment" data-method="paypal">
                                        <i class="fas fa-check"></i> <span data-i18n="payment.paid_paypal">J'ai pay√© avec PayPal</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Carte bancaire (Stripe) -->
                        <button class="payment-method-btn" data-method="card">
                            <div class="payment-method-icon" style="color: #635BFF;">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <div class="payment-method-name" data-i18n="payment.card_method">Visa/Mastercard/Amex (Stripe)</div>
                            <div class="payment-method-arrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </button>
                        
                        <div class="payment-method-details" id="cardDetails">
                            <div class="card-form">
                                <div class="stripe-card-element" id="card-element"></div>
                                <div id="card-errors" role="alert"></div>
                                
                                <div class="payment-notice">
                                    <p>
                                        <i class="fas fa-lock"></i>
                                        <strong data-i18n="payment.secure">S√©curis√© :</strong> <span data-i18n="payment.secure_message">Votre paiement est chiffr√© et s√©curis√© par Stripe. Aucune information bancaire n'est stock√©e sur nos serveurs.</span>
                                    </p>
                                </div>
                                
                                <div class="payment-action">
                                    <button class="btn-confirm-payment" id="processCardPayment" data-method="card" disabled>
                                        <i class="fas fa-lock"></i> <span data-i18n="payment.pay_with_card">Payer par carte</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Colonne droite : R√©capitulatif -->
                <div class="payment-card">
                    <h2 class="card-title" data-i18n="payment.summary">R√©capitulatif</h2>
                    
                    <div id="paymentSummary"></div>
                    
                    <div class="payment-security">
                        <h4><i class="fas fa-shield-alt"></i> <span data-i18n="payment.secure_payment">Paiement 100% s√©curis√©</span></h4>
                        <p style="font-size: 0.95rem; color: #2e7d32;">
                            <i class="fas fa-lock"></i> <span data-i18n="payment.encrypted">Vos donn√©es bancaires sont chiffr√©es</span><br>
                            <i class="fas fa-check-circle"></i> <span data-i18n="payment.no_storage">Aucune information stock√©e sur nos serveurs</span><br>
                            <i class="fas fa-clock"></i> <span data-i18n="payment.guaranteed">R√©servation garantie apr√®s paiement</span>
                        </p>
                    </div>
                    
                    <div style="margin-top: 25px; padding: 15px; background: #fff3cd; border-radius: 10px; border: 1px solid #ffeaa7;">
                        <p style="color: #856404; margin: 0; font-size: 0.95rem;">
                            <i class="fas fa-info-circle"></i> <span data-i18n="payment.time_slot">Votre cr√©neau est r√©serv√© pendant 15 minutes. Une fois le paiement confirm√©, vous recevrez un email avec le lien de la visioconf√©rence.</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Script Stripe -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="supabase.js"></script>
    <script src="translation.js"></script>
    <script src="currency.js"></script>
    <script src="packages.js"></script>
    <script src="auth.js"></script>
    <script src="booking.js"></script>
    <script src="payment.js"></script>
    <script src="mobile-menu.js"></script>
    <script src="common.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Initialisation page paiement...');
        
        // Variables globales
        let currentBooking = null;
        let currentCurrency = 'EUR';
        
        // R√©cup√©rer la r√©servation depuis l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const bookingParam = urlParams.get('booking');
        
        if (bookingParam) {
            try {
                currentBooking = JSON.parse(decodeURIComponent(bookingParam));
                console.log('üìã R√©servation r√©cup√©r√©e depuis URL:', currentBooking);
                currentCurrency = currentBooking.currency || 'EUR';
            } catch (error) {
                console.error('‚ùå Erreur parsing booking:', error);
                showPaymentError('R√©servation invalide. Veuillez r√©essayer.');
                return;
            }
        } else {
            const storedBooking = localStorage.getItem('pendingBooking');
            if (storedBooking) {
                try {
                    currentBooking = JSON.parse(storedBooking);
                    console.log('üìã R√©servation r√©cup√©r√©e depuis localStorage:', currentBooking);
                    currentCurrency = currentBooking.currency || 'EUR';
                } catch (error) {
                    console.error('‚ùå Erreur parsing stored booking:', error);
                }
            }
        }
        
        if (!currentBooking) {
            showPaymentError('Aucune r√©servation trouv√©e. Veuillez retourner √† la page de r√©servation.');
            setTimeout(() => {
                window.location.href = 'booking.html';
            }, 3000);
            return;
        }
        
        // Initialiser le menu mobile
        function initMobileMenu() {
            const hamburgerBtn = document.getElementById('hamburgerBtn');
            const closeMenuBtn = document.getElementById('closeMenuBtn');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (hamburgerBtn && mobileMenu) {
                hamburgerBtn.addEventListener('click', () => {
                    mobileMenu.classList.add('active');
                });
            }
            
            if (closeMenuBtn && mobileMenu) {
                closeMenuBtn.addEventListener('click', () => {
                    mobileMenu.classList.remove('active');
                });
            }
            
            if (mobileMenu) {
                mobileMenu.addEventListener('click', (e) => {
                    if (e.target === mobileMenu) {
                        mobileMenu.classList.remove('active');
                    }
                });
            }
        }
        
        // Initialiser les s√©lecteurs de devise
        function initCurrencySelectors() {
            // Initialiser les s√©lecteurs quand CurrencyManager est pr√™t
            const initSelectors = () => {
                if (!window.currencyManager) {
                    console.warn('CurrencyManager non disponible');
                    return;
                }
                
                const currencyManager = window.currencyManager;
                currentCurrency = currencyManager.currentCurrency;
                
                // Initialiser le s√©lecteur desktop
                const desktopSelector = document.getElementById('currencySelector');
                if (desktopSelector) {
                    desktopSelector.innerHTML = '';
                    
                    currencyManager.supportedCurrencies.forEach(currency => {
                        const option = document.createElement('option');
                        option.value = currency;
                        const symbol = currencyManager.currencySymbols[currency] || currency;
                        option.textContent = `${symbol} ${currency}`;
                        
                        if (currency === currentCurrency) {
                            option.selected = true;
                        }
                        
                        desktopSelector.appendChild(option);
                    });
                    
                    desktopSelector.addEventListener('change', (e) => {
                        const newCurrency = e.target.value;
                        console.log(`üí± Changement devise: ${currentCurrency} ‚Üí ${newCurrency}`);
                        
                        if (currencyManager.setCurrency(newCurrency)) {
                            currentCurrency = newCurrency;
                            updatePaymentDisplay();
                        }
                    });
                }
                
                // Initialiser le s√©lecteur mobile
                const mobileSelector = document.getElementById('currencySelectorMobile');
                if (mobileSelector) {
                    mobileSelector.innerHTML = '';
                    
                    currencyManager.supportedCurrencies.forEach(currency => {
                        const option = document.createElement('option');
                        option.value = currency;
                        const symbol = currencyManager.currencySymbols[currency] || currency;
                        option.textContent = `${symbol} ${currency}`;
                        
                        if (currency === currentCurrency) {
                            option.selected = true;
                        }
                        
                        mobileSelector.appendChild(option);
                    });
                    
                    mobileSelector.addEventListener('change', (e) => {
                        const newCurrency = e.target.value;
                        console.log(`üí± Changement devise mobile: ${currentCurrency} ‚Üí ${newCurrency}`);
                        
                        if (currencyManager.setCurrency(newCurrency)) {
                            currentCurrency = newCurrency;
                            updatePaymentDisplay();
                            
                            // Fermer le menu mobile
                            const mobileMenu = document.getElementById('mobileMenu');
                            if (mobileMenu) {
                                mobileMenu.classList.remove('active');
                            }
                        }
                    });
                }
                
                // Mettre √† jour l'affichage de la devise
                updateCurrencyDisplay();
                
                // Initialiser l'affichage des paiements
                updatePaymentDisplay();
            };
            
            // Attendre que CurrencyManager soit pr√™t
            if (window.currencyManager && window.currencyManager.exchangeRates) {
                initSelectors();
            } else {
                // √âcouter l'√©v√©nement de pr√™t
                window.addEventListener('currency:ready', initSelectors);
                window.addEventListener('currency:changed', initSelectors);
                
                // Fallback: v√©rifier p√©riodiquement
                setTimeout(() => {
                    if (window.currencyManager) {
                        initSelectors();
                    }
                }, 1000);
            }
        }
        
        // Mettre √† jour l'interface utilisateur
        function updateUserInterface() {
            const user = window.authManager?.getCurrentUser();
            const isLoggedIn = !!user;
            
            const userAvatar = document.getElementById('userAvatar');
            const loginBtn = document.getElementById('loginBtn');
            const avatarInitials = document.getElementById('avatarInitials');
            
            if (isLoggedIn && user) {
                if (userAvatar) userAvatar.style.display = 'block';
                if (loginBtn) loginBtn.style.display = 'none';
                
                if (avatarInitials && user.user_metadata?.full_name) {
                    const name = user.user_metadata.full_name;
                    avatarInitials.textContent = name.charAt(0).toUpperCase();
                } else if (avatarInitials && user.email) {
                    avatarInitials.textContent = user.email.charAt(0).toUpperCase();
                }
                
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', async (e) => {
                        e.preventDefault();
                        try {
                            await window.authManager.logout();
                            window.location.href = 'index.html';
                        } catch (error) {
                            console.error('Erreur d√©connexion:', error);
                        }
                    });
                }
            } else {
                if (userAvatar) userAvatar.style.display = 'none';
                if (loginBtn) loginBtn.style.display = 'block';
            }
        }
        
        // Mettre √† jour l'affichage des paiements
        function updatePaymentDisplay() {
            if (!currentBooking) return;
            
            console.log('üîÑ Mise √† jour affichage paiement avec devise:', currentCurrency);
            
            updatePaymentDetails(currentBooking);
            updatePaymentSummary(currentBooking);
            updateCurrencyDisplay();
        }
        
        // Mettre √† jour les d√©tails de paiement
        function updatePaymentDetails(booking) {
            const refNumber = Date.now().toString().slice(-6);
            
            // Calculer le montant dans la devise courante
            let amountToDisplay = booking.price;
            let currencyToDisplay = currentCurrency;
            
            // Si la devise a chang√©, recalculer le prix
            if (window.currencyManager && currentCurrency !== booking.currency) {
                console.log(`üí± Conversion n√©cessaire: ${booking.currency} ‚Üí ${currentCurrency}`);
                
                // D√©terminer la devise et le montant d'origine
                let originalAmount, originalCurrency;
                
                if (booking.isVip && booking.vipPriceData) {
                    // Pour les VIP, le prix d'origine est en USD
                    originalAmount = booking.vipPriceData.price * (booking.packageQuantity || 1);
                    originalCurrency = booking.vipPriceData.currency || 'USD';
                    
                    // Appliquer la r√©duction si applicable
                    if (booking.discountPercent && booking.discountPercent > 0) {
                        originalAmount = originalAmount * (1 - (booking.discountPercent / 100));
                    }
                } else {
                    // Pour les non-VIP, le prix d'origine est en EUR
                    originalAmount = booking.originalPrice || booking.priceEUR || booking.price;
                    originalCurrency = booking.originalCurrency || 'EUR';
                }
                
                // Convertir dans la devise courante
                amountToDisplay = window.currencyManager.convert(
                    originalAmount,
                    originalCurrency,
                    currentCurrency
                );
                
                console.log(`üí± Converti: ${originalAmount} ${originalCurrency} ‚Üí ${amountToDisplay} ${currentCurrency}`);
            }
            
            const config = window.YOTEACHER_CONFIG || {};
            
            const contactName = config.CONTACT_NAME || "Yoann Bourbia";
            const contactEmail = config.CONTACT_EMAIL || "yoannbourbia@gmail.com";
            const revolutLink = config.REVOLUT_PAYMENT_LINK || "https://revolut.me/yoann";
            const wiseLink = config.WISE_PAYMENT_LINK || "https://wise.com/pay/yoann";
            const paypalEmail = config.PAYPAL_BUSINESS_EMAIL || "https://paypal.me/yoannbourbia";
            const interacEmail = config.INTERAC_EMAIL || contactEmail;
            
            document.getElementById('revolutRefNum').textContent = refNumber;
            document.getElementById('interacRefNum').textContent = refNumber;
            
            // Formater le montant
            let formattedAmount;
            if (window.currencyManager) {
                formattedAmount = window.currencyManager.formatPriceInCurrency(amountToDisplay, currencyToDisplay);
            } else {
                formattedAmount = `${amountToDisplay.toFixed(2)} ${currencyToDisplay}`;
            }
            
            document.querySelectorAll('#revolutAmount, #wiseAmount, #paypalAmount, #interacAmount').forEach(el => {
                el.textContent = formattedAmount;
            });
            
            document.querySelectorAll('#revolutName, #wiseName, #paypalName, #interacName').forEach(el => {
                el.textContent = contactName;
            });
            
            document.getElementById('wiseEmail').textContent = contactEmail;
            document.getElementById('paypalEmail').textContent = paypalEmail;
            document.getElementById('interacEmail').textContent = interacEmail;
            
            const revolutDisplay = revolutLink.replace('https://', '');
            const wiseDisplay = wiseLink.replace('https://', '');
            const paypalUsername = paypalEmail.split('@')[0];
            const paypalDisplay = `paypal.me/${paypalUsername}`;
            
            document.getElementById('revolutLinkDisplay').textContent = revolutDisplay;
            document.getElementById('wiseLinkDisplay').textContent = wiseDisplay;
            document.getElementById('paypalLinkDisplay').textContent = paypalDisplay;
            
            // G√©n√©rer les liens de paiement avec le bon montant
            const revolutFullLink = `${revolutLink}?amount=${amountToDisplay}&currency=${currencyToDisplay}&reference=COURS-${refNumber}`;
            const wiseFullLink = `${wiseLink}?amount=${amountToDisplay}&currency=${currencyToDisplay}`;
            const paypalFullLink = `https://www.paypal.com/paypalme/${paypalUsername}/${amountToDisplay}${currencyToDisplay}`;
            
            document.getElementById('revolutQrCode').dataset.link = revolutFullLink;
            document.getElementById('revolutLinkItem').dataset.link = revolutFullLink;
            
            document.getElementById('wiseQrCode').dataset.link = wiseFullLink;
            document.getElementById('wiseLinkItem').dataset.link = wiseFullLink;
            
            document.getElementById('paypalQrCode').dataset.link = paypalFullLink;
            document.getElementById('paypalLinkItem').dataset.link = paypalFullLink;
        }
        
        // Mettre √† jour le r√©capitulatif
        function updatePaymentSummary(booking) {
            const summaryContainer = document.getElementById('paymentSummary');
            if (!summaryContainer) return;
            
            // Calculer le montant dans la devise courante
            let amountToDisplay = booking.price;
            
            if (window.currencyManager && currentCurrency !== booking.currency) {
                // D√©terminer la devise et le montant d'origine
                let originalAmount, originalCurrency;
                
                if (booking.isVip && booking.vipPriceData) {
                    // Pour les VIP, le prix d'origine est en USD
                    originalAmount = booking.vipPriceData.price * (booking.packageQuantity || 1);
                    originalCurrency = booking.vipPriceData.currency || 'USD';
                    
                    // Appliquer la r√©duction si applicable
                    if (booking.discountPercent && booking.discountPercent > 0) {
                        originalAmount = originalAmount * (1 - (booking.discountPercent / 100));
                    }
                } else {
                    // Pour les non-VIP, le prix d'origine est en EUR
                    originalAmount = booking.originalPrice || booking.priceEUR || booking.price;
                    originalCurrency = booking.originalCurrency || 'EUR';
                }
                
                // Convertir dans la devise courante
                amountToDisplay = window.currencyManager.convert(
                    originalAmount,
                    originalCurrency,
                    currentCurrency
                );
            }
            
            const formattedPrice = window.currencyManager ? 
                window.currencyManager.formatPriceInCurrency(amountToDisplay, currentCurrency) : 
                `${amountToDisplay.toFixed(2)} ${currentCurrency}`;
            
            const startDate = new Date(booking.startTime);
            const formattedDate = startDate.toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            const formattedTime = startDate.toLocaleTimeString('fr-FR', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            let courseName = '';
            switch(booking.courseType) {
                case 'essai':
                    courseName = window.translationManager?.getTranslation('courses.trial') || 'Cours d\'essai';
                    break;
                case 'conversation':
                    courseName = window.translationManager?.getTranslation('courses.conversation') || 'Conversation';
                    break;
                case 'curriculum':
                    courseName = window.translationManager?.getTranslation('courses.curriculum') || 'Curriculum complet';
                    break;
                case 'examen':
                    courseName = window.translationManager?.getTranslation('courses.exam') || 'Pr√©paration d\'examen';
                    break;
                default:
                    courseName = booking.courseType;
            }
            
            let platform = 'Zoom';
            if (booking.location && booking.location.includes('google')) {
                platform = 'Google Meet';
            } else if (booking.location && booking.location.includes('teams')) {
                platform = 'Microsoft Teams';
            }
            
            const courseLabel = window.translationManager?.getTranslation('payment.course_type') || 'Type de cours:';
            const dateLabel = window.translationManager?.getTranslation('payment.date') || 'Date:';
            const timeLabel = window.translationManager?.getTranslation('payment.time') || 'Heure:';
            const durationLabel = window.translationManager?.getTranslation('payment.duration') || 'Dur√©e:';
            const platformLabel = window.translationManager?.getTranslation('payment.platform') || 'Plateforme:';
            const totalLabel = window.translationManager?.getTranslation('payment.total') || 'Total √† payer:';
            
            // Ajouter des informations VIP si applicable
            let vipInfo = '';
            if (booking.isVip) {
                vipInfo = `
                    <div class="summary-item" style="background: #fff8e1; border-radius: 8px; padding: 10px;">
                        <span class="label" style="color: #ff8f00;"><i class="fas fa-crown"></i> Statut:</span>
                        <span class="value" style="color: #ff8f00; font-weight: 600;">Prix VIP appliqu√©</span>
                    </div>
                `;
            }
            
            // Ajouter des informations sur le forfait si applicable
            let packageInfo = '';
            if (booking.isPackage && booking.packageQuantity > 1) {
                const discount = booking.discountPercent || 0;
                packageInfo = `
                    <div class="summary-item">
                        <span class="label">Forfait:</span>
                        <span class="value">${booking.packageQuantity} cours</span>
                    </div>
                    ${discount > 0 ? `
                    <div class="summary-item" style="background: #e8f5e9; border-radius: 8px; padding: 10px;">
                        <span class="label" style="color: #2e7d32;">R√©duction:</span>
                        <span class="value" style="color: #2e7d32; font-weight: 600;">${discount}%</span>
                    </div>
                    ` : ''}
                `;
            }
            
            summaryContainer.innerHTML = `
                <div class="booking-summary-card">
                    <h3 style="margin-bottom: 20px; color: #333;" data-i18n="payment.booking_details">D√©tails de votre r√©servation</h3>
                    <div class="summary-details">
                        ${vipInfo}
                        <div class="summary-item">
                            <span class="label">${courseLabel}</span>
                            <span class="value">${courseName}</span>
                        </div>
                        ${packageInfo}
                        <div class="summary-item">
                            <span class="label">${dateLabel}</span>
                            <span class="value">${formattedDate}</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">${timeLabel}</span>
                            <span class="value">${formattedTime}</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">${durationLabel}</span>
                            <span class="value">${booking.duration || '15'} min</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">${platformLabel}</span>
                            <span class="value">${platform}</span>
                        </div>
                        <div class="summary-item total">
                            <span class="label">${totalLabel}</span>
                            <span class="value">${formattedPrice}</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Mettre √† jour l'affichage de la devise
        function updateCurrencyDisplay() {
            if (window.currencyManager) {
                const currentCurrencySpan = document.getElementById('currentCurrency');
                if (currentCurrencySpan) {
                    currentCurrencySpan.textContent = window.currencyManager.currentCurrency;
                }
                
                // Mettre √† jour le s√©lecteur de devise
                const desktopSelector = document.getElementById('currencySelector');
                if (desktopSelector && desktopSelector.value !== window.currencyManager.currentCurrency) {
                    desktopSelector.value = window.currencyManager.currentCurrency;
                }
                
                const mobileSelector = document.getElementById('currencySelectorMobile');
                if (mobileSelector && mobileSelector.value !== window.currencyManager.currentCurrency) {
                    mobileSelector.value = window.currencyManager.currentCurrency;
                }
            }
        }
        
        // Gestion des boutons de m√©thode de paiement
        function setupPaymentMethodButtons() {
            document.querySelectorAll('.payment-method-btn').forEach(button => {
                button.addEventListener('click', async function() {
                    const method = this.getAttribute('data-method');
                    
                    togglePaymentMethod(method);
                    
                    // Gestion sp√©ciale pour Interac
                    if (method === 'interac' && window.currencyManager) {
                        const interacNotice = document.getElementById('interacCurrencyNotice');
                        
                        console.log(`üí± S√©lection Interac d√©tect√©e. Devise actuelle: ${currentCurrency}`);
                        
                        if (currentCurrency !== 'CAD') {
                            if (interacNotice) {
                                interacNotice.style.display = 'block';
                            }
                            
                            try {
                                console.log('üí± For√ßage de la devise CAD pour Interac...');
                                
                                // Sauvegarder la devise pr√©c√©dente
                                const previousCurrency = currentCurrency;
                                localStorage.setItem('previousCurrency', previousCurrency);
                                
                                // Changer la devise en CAD
                                if (window.currencyManager.setCurrency('CAD')) {
                                    currentCurrency = 'CAD';
                                    console.log('‚úÖ Devise chang√©e en CAD avec succ√®s');
                                    
                                    // Mettre √† jour l'affichage
                                    updatePaymentDisplay();
                                } else {
                                    console.error('‚ùå √âchec du changement de devise en CAD');
                                }
                            } catch (error) {
                                console.error('‚ùå Erreur lors du for√ßage CAD:', error);
                            }
                        } else {
                            if (interacNotice) {
                                interacNotice.style.display = 'none';
                            }
                            console.log('‚úÖ D√©j√† en CAD, pas de changement n√©cessaire');
                        }
                    } else {
                        const interacNotice = document.getElementById('interacCurrencyNotice');
                        if (interacNotice) {
                            interacNotice.style.display = 'none';
                        }
                        
                        // Restaurer la devise pr√©c√©dente si on quitte Interac
                        if (method !== 'interac') {
                            const previousCurrency = localStorage.getItem('previousCurrency');
                            if (previousCurrency && previousCurrency !== currentCurrency && window.currencyManager) {
                                console.log(`üí± Restauration devise pr√©c√©dente: ${previousCurrency}`);
                                if (window.currencyManager.setCurrency(previousCurrency)) {
                                    currentCurrency = previousCurrency;
                                    updatePaymentDisplay();
                                    localStorage.removeItem('previousCurrency');
                                }
                            }
                        }
                    }
                });
            });
        }
        
        // Gestion des clics sur les QR codes et liens cliquables
        function setupClickableElements() {
            document.querySelectorAll('.qr-code-img').forEach(img => {
                img.addEventListener('click', function() {
                    const link = this.dataset.link;
                    if (link) {
                        window.open(link, '_blank');
                    } else {
                        const method = this.id.replace('QrCode', '').toLowerCase();
                        if (method === 'revolut') {
                            window.open('https://revolut.me/yoann', '_blank');
                        } else if (method === 'wise') {
                            window.open('https://wise.com/pay/yoann', '_blank');
                        } else if (method === 'paypal') {
                            window.open('https://paypal.me/yoann', '_blank');
                        }
                    }
                });
                
                img.addEventListener('error', function() {
                    console.warn(`‚ö†Ô∏è Image non trouv√©e: ${this.src}`);
                    this.style.display = 'none';
                    const placeholder = document.createElement('div');
                    placeholder.className = 'qr-code-placeholder';
                    placeholder.innerHTML = `
                        <i class="fas fa-qrcode"></i>
                        <p style="font-size: 0.8rem; margin-top: 5px;" data-i18n="payment.qr_code">QR Code</p>
                    `;
                    placeholder.dataset.link = this.dataset.link;
                    placeholder.addEventListener('click', function() {
                        const link = this.dataset.link;
                        if (link) window.open(link, '_blank');
                    });
                    this.parentNode.appendChild(placeholder);
                });
            });
            
            document.querySelectorAll('.info-item.clickable').forEach(item => {
                item.addEventListener('click', function() {
                    const link = this.dataset.link;
                    if (link) {
                        window.open(link, '_blank');
                    }
                });
            });
        }
        
        // Basculer entre les m√©thodes de paiement
        function togglePaymentMethod(method) {
            document.querySelectorAll('.payment-method-details').forEach(details => {
                details.style.display = 'none';
            });
            
            document.querySelectorAll('.payment-method-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const detailsId = method + 'Details';
            const detailsElement = document.getElementById(detailsId);
            const buttonElement = document.querySelector(`[data-method="${method}"]`);
            
            if (detailsElement && buttonElement) {
                const isAlreadyOpen = detailsElement.style.display === 'block';
                
                if (!isAlreadyOpen) {
                    detailsElement.style.display = 'block';
                    buttonElement.classList.add('active');
                    
                    if (method === 'card' && window.paymentManager && typeof window.paymentManager.setupStripeForm === 'function') {
                        window.paymentManager.setupStripeForm();
                    }
                    
                    if (window.innerWidth <= 768) {
                        setTimeout(() => {
                            detailsElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }, 100);
                    }
                } else {
                    detailsElement.style.display = 'none';
                    buttonElement.classList.remove('active');
                }
            }
        }
        
        // Gestion des boutons de confirmation de paiement
        function setupPaymentConfirmationButtons() {
            document.querySelectorAll('.btn-confirm-payment').forEach(button => {
                button.addEventListener('click', async function() {
                    if (this.disabled) return;
                    
                    const method = this.getAttribute('data-method');
                    console.log('üí≥ Confirmation paiement:', method);
                    
                    // Validation pour Interac
                    if (method === 'interac' && window.currencyManager && !window.currencyManager.isInteracCurrency()) {
                        showPaymentError('Les paiements Interac doivent √™tre effectu√©s en dollars canadiens (CAD). Veuillez s√©lectionner CAD comme devise.');
                        return;
                    }
                    
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ' + (window.translationManager?.getTranslation('payment.processing') || 'Traitement en cours...');
                    this.disabled = true;
                    
                    hidePaymentError();
                    
                    try {
                        if (window.paymentManager) {
                            // Mettre √† jour le prix dans la r√©servation avec la devise courante
                            const updatedBooking = { ...currentBooking };
                            updatedBooking.currency = currentCurrency;
                            
                            // Recalculer le prix si n√©cessaire
                            if (window.currencyManager && currentCurrency !== currentBooking.currency) {
                                let originalAmount, originalCurrency;
                                
                                if (currentBooking.isVip && currentBooking.vipPriceData) {
                                    originalAmount = currentBooking.vipPriceData.price * (currentBooking.packageQuantity || 1);
                                    originalCurrency = currentBooking.vipPriceData.currency || 'USD';
                                    
                                    if (currentBooking.discountPercent && currentBooking.discountPercent > 0) {
                                        originalAmount = originalAmount * (1 - (currentBooking.discountPercent / 100));
                                    }
                                } else {
                                    originalAmount = currentBooking.originalPrice || currentBooking.priceEUR || currentBooking.price;
                                    originalCurrency = currentBooking.originalCurrency || 'EUR';
                                }
                                
                                updatedBooking.price = window.currencyManager.convert(
                                    originalAmount,
                                    originalCurrency,
                                    currentCurrency
                                );
                            }
                            
                            window.paymentManager.currentBooking = updatedBooking;
                            await window.paymentManager.handlePaymentMethod(method);
                        } else {
                            throw new Error('PaymentManager non disponible');
                        }
                    } catch (error) {
                        console.error('‚ùå Erreur paiement:', error);
                        showPaymentError('Erreur lors du traitement : ' + error.message);
                        
                        this.innerHTML = originalText;
                        this.disabled = false;
                    }
                });
            });
        }
        
        // Afficher une erreur de paiement
        function showPaymentError(message) {
            const errorDiv = document.getElementById('paymentError');
            const errorText = document.getElementById('errorText');
            
            if (errorDiv && errorText) {
                errorText.textContent = message;
                errorDiv.style.display = 'block';
                
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                alert('Erreur: ' + message);
            }
        }
        
        // Cacher l'erreur de paiement
        function hidePaymentError() {
            const errorDiv = document.getElementById('paymentError');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
        }
        
        // Fermer les menus en cliquant en dehors
        function setupOutsideClickHandlers() {
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.payment-method-btn') && !event.target.closest('.payment-method-details')) {
                    document.querySelectorAll('.payment-method-details').forEach(details => {
                        details.style.display = 'none';
                    });
                    
                    document.querySelectorAll('.payment-method-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                }
            });
        }
        
        // Initialiser toutes les fonctionnalit√©s
        function initializeAll() {
            console.log('üîß Initialisation des fonctionnalit√©s...');
            
            initMobileMenu();
            initCurrencySelectors();
            updateUserInterface();
            setupPaymentMethodButtons();
            setupClickableElements();
            setupPaymentConfirmationButtons();
            setupOutsideClickHandlers();
            
            // √âcouter les √©v√©nements d'authentification
            window.addEventListener('auth:login', updateUserInterface);
            window.addEventListener('auth:logout', updateUserInterface);
            
            // √âcouter les changements de devise
            window.addEventListener('currency:changed', function(e) {
                console.log('üí± √âv√©nement currency:changed re√ßu', e.detail);
                currentCurrency = window.currencyManager.currentCurrency;
                updatePaymentDisplay();
            });
            
            console.log('‚úÖ Page paiement compl√®tement initialis√©e');
        }
        
        // D√©marrer l'initialisation
        initializeAll();
    });
    </script>
</body>
</html>