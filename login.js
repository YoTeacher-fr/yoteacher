!function(){function e(e){const t=document.getElementById("errorMessage"),n=document.getElementById("errorText"),o=document.getElementById("successMessage");n&&(n.textContent=e),t&&(t.style.display="block"),o&&(o.style.display="none")}function t(e){const t=document.getElementById("successMessage"),n=document.getElementById("successText"),o=document.getElementById("errorMessage");n&&(n.textContent=e),t&&(t.style.display="block"),o&&(o.style.display="none")}function n(){const e=document.getElementById("errorMessage"),t=document.getElementById("successMessage");e&&(e.style.display="none"),t&&(t.style.display="none")}function o(){const o=document.getElementById("loginForm"),s=(document.getElementById("errorMessage"),document.getElementById("successMessage"),document.getElementById("errorText"),document.getElementById("successText"),document.getElementById("forgotPasswordLink"));window.authManager?.isAuthenticated()&&(window.location.href="dashboard.html"),document.querySelectorAll(".login-btn, .mobile-login-btn-header").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault()})}),o.addEventListener("submit",async function(s){s.preventDefault();const r=document.getElementById("email").value,i=document.getElementById("password").value;if(!r||!i)return void e("Veuillez remplir tous les champs");n();const a=o.querySelector("button"),d=a.innerHTML;a.innerHTML='<i class="fas fa-spinner fa-spin"></i> '+(window.translationManager?.getTranslation("login.loading")||"Connexion en cours..."),a.disabled=!0;try{const n=await window.authManager.signIn(r,i);if(n.success){t(window.translationManager?.getTranslation("login.success")||"Connexion réussie ! Redirection...");const e=n.redirectUrl||"dashboard.html";setTimeout(()=>{window.location.href=e},1500)}else e(n.error||"Erreur de connexion"),a.innerHTML=d,a.disabled=!1}catch(t){e("Une erreur est survenue : "+t.message),a.innerHTML=d,a.disabled=!1}}),s.addEventListener("click",async function(o){o.preventDefault();const s=document.getElementById("email").value;if(s){n();try{const{error:e}=await supabase.auth.resetPasswordForEmail(s,{redirectTo:window.location.origin+"/reset-password.html"});if(e)throw e;t("Un email de réinitialisation a été envoyé à "+s)}catch(t){e("Erreur : "+t.message)}}else e("Veuillez entrer votre adresse email pour réinitialiser votre mot de passe")});const r=document.querySelector('.auth-footer a[href="signup.html"]');if(r){const e=new URLSearchParams(window.location.search).get("redirect");if(e){const t=r.getAttribute("href"),n=t.includes("?")?"&":"?";r.href=`${t}${n}redirect=${e}`}}}function s(){window.location.pathname.includes("login.html")&&(window.authManager&&window.supabase?o():setTimeout(s,100))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):setTimeout(s,100),console.log("✅ login.js chargé - Gestion de la page de connexion")}();
